@{
	ViewData["Title"] = "Forecast Costos";
}

<style>
	.form-container {
		max-width: 1200px;
		margin: 0 auto;
		background-color: #fff;
		padding: 20px;
		border-radius: 10px;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		margin-top: 60px;
	}

	.form-title {
		font-size: 1.2rem;
		font-weight: 600;
		color: #333;
		text-align: center;
		margin-bottom: 10px;
	}

	.form-subtitle {
		font-size: 1.0rem;
		color: #666;
		text-align: center;
		margin-bottom: 20px;
	}



	.highlight {
		background-color: #f8d7da;
		font-weight: bold;
	}

	.panel-container {
		display: flex;
		justify-content: space-between;
		gap: 0px;
		width: 100%;
		margin-top: 0;
		padding-top: 0;
	}

	.panel-item {
		flex-grow: 1;
		border: 2px solid #444;
		border-radius: 0;
		padding: 10px 20px;
		background-color: #f2f3f4;
		color: black;
		text-align: center;
		transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
	}



		.panel-item:hover {
			background-color: #fcaa67;
			color: #fff;
		}

	.alert {
		padding: 15px;
		font-size: 16px;
		font-weight: bold;
		border: 1px solid transparent;
		border-radius: 5px;
		margin-bottom: 15px;
		text-align: center;
		transition: opacity 0.3s ease-in-out;
	}

	.alert-danger {
		background-color: #f8d7da;
		color: #721c24;
		border-color: #f5c6cb;
	}

	.alert-success {
		background-color: #d4edda;
		color: #155724;
		border-color: #c3e6cb;
	}
</style>
@{
	int? idproyecto = Context.Session.GetInt32("numproyecto");
	int idproyectos = 0;
	decimal totalsocios = 0;
	decimal totalstaff = 0;

	decimal totalsociosproyectados = 0;
	decimal totalstaffproyectados = 0;
	decimal totalserviciosproyectados = 0;
	decimal totalgastosproyectados = 0;
	decimal totalcostosproyectados = 0;
	int idcuentasocio = ViewBag.Idcuentasocio;
	decimal costohhscio = ViewBag.costohhsocio;

	string? cuentasocio = ViewBag.cuentasocio;
	int idcuentastaff = ViewBag.Idcuentastaff;
	string? cuentastaff = ViewBag.cuentastaff;
	decimal costohhstaff = ViewBag.costohhstaff;
	decimal totalsociosforecast = 0;
	decimal totalstaffforecast = 0;

}

<div class="max-w-[1200px] py-3 mx-auto mt-10">
	@foreach (var proyecto in ViewBag.Proyecto)
	{
		idproyectos = proyecto.Id;
		<div class="flex bg-white rounded-t-xl overflow-hidden border border-gray-300">
			<!--tab marcada-->
			<a href="#"
			   class="flex-1 text-center py-3 text-sm font-medium border-b-2 transition duration-300
           @(ViewContext.RouteData.Values["action"]?.ToString() == "ForecastCostos"
               ? "text-orange-500 border-orange-500 bg-white"
               : "text-gray-600 border-transparent hover:text-orange-500 hover:border-orange-500")">
				Forecast Costos del Proyecto
			</a>
			<!-- TAB 1 -->
			<a href="@Url.Action("ForecastIngreso","EjecucionProyecto",new{id=idproyectos})"
			   class="flex-1 text-center py-3 text-sm font-medium border-b-2 transition duration-300
           @(ViewContext.RouteData.Values["action"]?.ToString() == "ForecastIngreso"
               ? "text-orange-500 border-orange-500 bg-white"
               : "text-gray-600 border-transparent hover:text-orange-500 hover:border-orange-500")">
				Forecast Ingresos del Proyecto
			</a>

			<!-- TAB 2 -->
			<a href="@Url.Action("FlujoCajaProyecto","EjecucionProyecto",new{id=idproyectos})"
			   class="flex-1 text-center py-3 text-sm font-medium border-b-2 transition duration-300
           @(ViewContext.RouteData.Values["action"]?.ToString() == "FlujoCajaProyecto"
               ? "text-orange-500 border-orange-500 bg-white"
               : "text-gray-600 border-transparent hover:text-orange-500 hover:border-orange-500")">
				Flujo de Caja del Proyecto
			</a>

			<!-- TAB 3 -->
			<a href="@Url.Action("SeleccionarProyecto","EjecucionProyecto",new{statusproyecto=2})"
			   class="flex-1 text-center py-3 text-sm font-medium border-b-2 transition duration-300
           @(ViewContext.RouteData.Values["action"]?.ToString() == "SeleccionarProyecto"
               ? "text-orange-500 border-orange-500 bg-white"
               : "text-gray-600 border-transparent hover:text-orange-500 hover:border-orange-500")">
				Seleccionar otro Proyecto
			</a>
		</div>

	}


	<div class=" bg-white p-6 border border-t-0 border-gray-300 rounded-b-xl shadow">
		@if (TempData["ErrorMessage"] != null)
		{
			<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
				@TempData["ErrorMessage"]
			</div>
		}
		@if (TempData["SuccessMessage"] != null)
		{
			<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4" role="alert">
				@TempData["SuccessMessage"]
			</div>
		}


		<div class="form-group">

			@foreach (var proyecto in ViewBag.Proyecto)
			{
				
				<p class="form-subtitle" style="color:black;">Información del Proyecto</p>

				<input type="hidden" id="unidadNegocio" value="@proyecto.IDUNEGOCIO" />
				<input type="hidden" id="centroCosto" value="@proyecto.IDCOSTO" />
				<input type="hidden" id="codigo" value="@proyecto.Codigo" />
				<div class="overflow-x-auto">
					<table class="min-w-full text-xs border-collapse">
						<thead>
							<tr class="bg-green-100 text-black">
								<th class="p-2 border border-gray-300 text-left">Número del Proyecto</th>
								<th class="p-2 border border-gray-300 text-left">Proyecto</th>
								<th class="p-2 border border-gray-300 text-left">Cliente</th>
								<th class="p-2 border border-gray-300 text-left">Departamento</th>
								<th class="p-2 border border-gray-300 text-left">Moneda</th>
								@if (proyecto.MontoOrigenExtranjero > 0)
								{
									<th class="p-2 border border-gray-300 text-left">Monto Moneda Origen</th>
								}
								<th class="p-2 border border-gray-300 text-left">MontoCLP</th>
								<th class="p-2 border border-gray-300 text-left">C.Costo</th>
								<th class="p-2 border border-gray-300 text-left">Código</th>
								<th class="p-2 border border-gray-300 text-left">Tipología</th>
								<th class="p-2 border border-gray-300 text-left">Empresa</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td class="p-2 border border-gray-300 text-left">@proyecto.numproyecto</td>
								<td class="p-2 border border-gray-300 text-left">@proyecto.NombreProyecto</td>
								<td class="p-2 border border-gray-300 text-left">@proyecto.NombreCliente</td>
								<td class="p-2 border border-gray-300 text-left">@proyecto.NOMBREDEPARTAMENTO</td>
								<td class="p-2 border border-gray-300 text-left" data-moneda="@proyecto.MONEDA">

									@proyecto.MONEDA
								</td>
								@if (proyecto.MontoOrigenExtranjero > 0)
								{
									<td class="p-2 border border-gray-300 text-left">@String.Format("{0:N0}", @proyecto.MontoOrigenExtranjero)</td>
								}
								<td class="p-2 border border-gray-300 text-left">@String.Format("{0:N0}", @proyecto.MONTO)</td>
								<td class="p-2 border border-gray-300 text-left">@proyecto.Tipo_CCosto</td>
								<td class="p-2 border border-gray-300 text-left">@proyecto.Codigo</td>
								<td class="p-2 border border-gray-300 text-left">@proyecto.Tipo_Tipologia</td>
								<td class="p-2 border border-gray-300 text-left">@proyecto.Tipo_Empresa</td>
							</tr>
						</tbody>
					</table>
				</div>

				totalsociosproyectados = proyecto.HHSOCIOS * @proyecto.COSTO_SOCIO;
				totalstaffproyectados = proyecto.HHSTAFF * @proyecto.COSTO_STAFF;

			}
		</div>
		<form asp-action="RegistrarCostos" asp-controller="EjecucionProyecto" method="post">
			<input type="hidden" name="idproyecto" value="@idproyecto" />

			<div class="form-group">

				<p class="form-subtitle" style="color:black;">Status Gastos HH Socios</p>
				<div class="overflow-x-auto">
					<table class="min-w-full text-xs border-collapse">
						<thead>
							<tr class="bg-blue-100 text-black">

								<th class="p-2 border border-gray-300 text-left">Fecha</th>
								<th class="p-1 border border-gray-300 text-left">FechaPago</th>
								<th class="p-2 border border-gray-300 text-left">IDCUENTA</th>
								<th class="p-2 border border-gray-300 text-left">Cuenta Contable</th>
								<th class="p-2 border border-gray-300 text-left">Horas Efectivas</th>
								<th class="p-2 border border-gray-300 text-left">SubTotal</th>
								<th class="p-2 border border-gray-300 text-left">Reajuste</th>
								<th class="p-2 border border-gray-300 text-left">Total</th>
								<th class="p-2 border border-gray-300 text-left">Glosa</th>


							</tr>
						</thead>
						<tbody>
							@if (ViewBag.GastosHH != null)
							{

								@for (int i = 0; i < ViewBag.GastosHH.Count; i++)
								{

									var gasto = ViewBag.GastosHH[i];
									@if (gasto.tiporecurso == "Socio" && gasto.estado != 2)
									{


										<tr>
											<input type="hidden" name="Tiporecurso" value="@gasto.tiporecurso" />
											<input type="hidden" name="Mes" value="@gasto.mes" />
											<input type="hidden" name="Anio" value="@gasto.anio" />
											<input type="hidden" name="Subtotal" value="@gasto.costorecursosocio" />
											<input type="hidden" name="HHtotales" value="@gasto.totalhh" />

											<td class="p-2 border border-gray-300 text-left">@gasto.mes/@gasto.anio</td>
											<input type="hidden" name="IdGastoHH" value="@gasto.idgastohh" />
											@if (gasto.fechapago != null)
											{
												<td class="p-1 border border-gray-300 text-right">
													<input type="date" name="Fechapago" value="@gasto.fechapago?.ToString("yyyy-MM-dd")" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" />
												</td>

											}

											else
											{
												<td class="p-1 border border-gray-300 text-right">
													<input type="date" name="Fechapago" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" />
												</td>


											}

											<td class="p-2 border border-gray-300 text-right">@gasto.idcuentasocio</td>
											<td class="p-1">@gasto.cuentasocio</td>

											<td class="p-1 border border-gray-300 text-right w-20">@String.Format("{0:N2}", gasto.totalhh)</td>
											<td class="p-1 border border-gray-300 text-right w-25">@String.Format("{0:N0}", gasto.costorecursosocio)</td>
											@if (gasto.reajuste != null)
											{
												<td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}",gasto.reajuste ?? "")" name="Reajuste" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											}

											else
											{
												<td class="p-2 border border-gray-300 text-right"><input type="text" name="Reajuste" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											}
											@if (gasto.monto != null)
											{
												<td class="p-2 border border-gray-300 text-right"><input type="text" id="montosocio" value="@String.Format("{0:N0}",gasto.monto ?? "")" readonly name="Monto" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											}
											else
											{
												<td class="p-2 border border-gray-300 text-right"><input type="text" id="montosocio" readonly name="Monto" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											}
											@if (gasto.observacion != "")
											{

												<td class="p-2 border border-gray-300 text-left">
													<textarea rows="2" name="Observacion" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48">@gasto.observacion</textarea>
												</td>

											}
											else
											{
												<td class="p-2 border border-gray-300 text-left">
													<textarea rows="2" name="Observacion" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
												</td>
											}
											@if (gasto.estado == 1)
											{
												totalsocios += gasto.monto ?? 0;
											}



										</tr>
									}
								}

							}


						</tbody>
					</table>

				</div>







			</div>

			@*HH FORECAST SOCIOS*@
			<div class="form-group">

				<p class="form-subtitle" style="color:black;">Forecast HH Socios</p>
				<div class="overflow-x-auto">
					<table id="tablahhSocios" class="min-w-full text-xs border-collapse">
						<thead>
							<tr class="bg-green-200 text-black">
								<th class="p-2 border border-gray-300 text-left">Fecha Pago</th>
								<th class="p-2 border border-gray-300 text-center">HH</th>
								<th class="p-2 border border-gray-300 text-left">Valor HH/Proyecto</th>
								<th class="p-2 border border-gray-300 text-left">Total</th>



								<th class="p-2 border border-gray-300 text-left">Glosa</th>

								<th class="p-2 border border-gray-300 text-left">IDCUENTA</th>
								<th class="p-2 border border-gray-300 text-left">Cuenta Contable</th>
								<th class="p-2 border border-gray-300 text-left">Acción</th>



							</tr>
						</thead>
						<tbody>
							@if (ViewBag.GastosHH != null)
							{
								@foreach (var gs in ViewBag.GastosHH)
								{
									if (gs.estado == 2 && gs.tiporecurso == "Socio")
									{
										<tr>
											<td class="p-2 border border-gray-300 text-left"><input type="date" value="@gs.fechapago.ToString("yyyy-MM-dd")" name="fechahhsocio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
											<td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}", @gs.totalhh)" name="hhsocio" class="hhsocio form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											<td class="p-2 border border-gray-300 text-right costohhsocio">
												@String.Format("{0:N0}", @gs.costohhsocio)
											</td>
											<td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}",gs.monto ?? "")" readonly name="montohhsocio" class="montohhsocio form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>



											<td class="p-2 border border-gray-300 text-left">
												<textarea rows="2" name="observacionhhsocio" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48">@gs.observacion</textarea>
											</td>
											<td class="p-2 border border-gray-300 text-right ">@gs.idcuentasocio</td>
											<td class="p-2 border border-gray-300 text-left ">@gs.cuentasocio</td>

											<td style="display:none;">
												<input type="hidden" name="EliminarhhSocio" class="EliminarhhSocio" value="false" />
											</td>
											<td class="p-2 border border-gray-300 text-left">
												<button type="button" class="bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-700" onclick="limpiarhhSocio(this)">Eliminar</button>
											</td>

										</tr>
										totalsociosforecast += gs.monto;
										<input type="hidden" name="Idhhsocio" value="@gs.idgastohh" />
										<input type="hidden" name="estadohhsocio" value="@gs.estado" />
										<input type="hidden" name="recursohhsocio" value="@gs.tiporecurso" />
									}

								}
							}
							<tr>
								<td class="p-2 border border-gray-300 text-left"><input type="date" name="fechahhsocio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
								<td class="p-2 border border-gray-300 text-right"><input type="text" name="hhsocio" class="hhsocio  form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
								<td class="p-2 border border-gray-300 text-right costohhsocio"> @String.Format("{0:N0}", costohhscio)</td>
								<td class="p-2 border border-gray-300 text-right"><input type="text" id="montohhsocio" readonly name="montohhsocio" class="montohhsocio form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>



								<td class="p-2 border border-gray-300 text-left">
									<textarea rows="2" name="observacionhhsocio" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
								</td>
								<td class="p-2 border border-gray-300 text-right ">@idcuentasocio</td>
								<td class="p-2 border border-gray-300 text-left ">@cuentasocio</td>
								<td style="display:none;">
									<input type="hidden" name="EliminarhhSocio" class="EliminarhhSocio" value="false" />
								</td>

								<input type="hidden" name="Idhhsocio" value="" />
								<input type="hidden" name="estadohhsocio" value="2" />
								<input type="hidden" name="recursohhsocio" value="Socio" />
							</tr>

						</tbody>
					</table>
					<button id="btnAgregarhhSocio" class="px-4 py-2 text-sm text-white bg-blue-500 border border-gray-300 rounded transition duration-300 ease-in-out hover:bg-blue-400 hover:opacity-80">Agregar otro Forecast hh Socio</button>

				</div>

			</div>



			@*<div class="form-group">

            <p class="form-subtitle" style="color:black;">Otros Gastos Socios</p>
            <div class="overflow-x-auto">
                <table id="tablaGastosSocios" class="min-w-full text-xs border-collapse">
                    <thead>
                        <tr class="bg-red-100 text-black">
                            <th class="p-2 border border-gray-300 text-left">TipoServicios</th>
                            <th class="p-2 border border-gray-300 text-left">Proveedor</th>
                            <th class="p-2 border border-gray-300 text-left">Monto</th>
                            <th class="p-2 border border-gray-300 text-left">FechaPago</th>
                            <th class="p-2 border border-gray-300 text-left">Estado</th>


                            <th class="p-2 border border-gray-300 text-left">Glosa</th>

                            <th class="p-2 border border-gray-300 text-left">IDCUENTA</th>
                            <th class="p-2 border border-gray-300 text-left">Cuenta Contable</th>
                            <th class="p-2 border border-gray-300 text-left">Acción</th>



                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.ServiciosEjecucion != null)
                        {
                            @foreach (var se in ViewBag.ServiciosEjecucion)
                            {
                                if (se.Tiposervicio == "Socios")
                                {
                                    <tr>
                                        <td class="p-2 border border-gray-300 text-left">
                                            <select name="Idserviciosocio" class="serviciosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="" disabled selected>Seleccione un Servicio</option>
                                                @if (ViewBag.Servicios != null)
                                                {
                                                    @foreach (var servicio in ViewBag.Servicios)
                                                    {
                                                        if (servicio.Id == se.Idservicio)
                                                        {
                                                            <option value="@servicio.Id" selected>@servicio.Nombre</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@servicio.Id">@servicio.Nombre</option>
                                                        }
                                                    }
                                                }
                                            </select>

                                        </td>
                                        <td class="p-2 border border-gray-300 text-left">
                                            <select name="Idproveedorsocio" class="proveedorSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="" disabled selected>Seleccione un Servicio</option>
                                                @if (ViewBag.Proveedores != null)
                                                {
                                                    @foreach (var proveedor in ViewBag.Proveedores)
                                                    {
                                                        if (proveedor.Id == se.Idproveedor)
                                                        {
                                                            <option value="@proveedor.Id" selected>@proveedor.Nombre</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@proveedor.Id">@proveedor.Nombre</option>
                                                        }
                                                    }
                                                }
                                            </select>

                                        </td>
                                        <td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}", @se.Monto)" id="montoservicio" name="montoserviciosocio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
                                        <td class="p-2 border border-gray-300 text-left"><input type="date" value="@se.Fecha.ToString("yyyy-MM-dd")" name="fechaserviciosocio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
                                        <td class="p-2 border border-gray-300 text-left">
                                            <select name="Estadosocio" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">


                                                @if (se.Estado == "Forecast")
                                                {
                                                    <option value="Forecast" selected>Forecast</option>
                                                }
                                                else
                                                {
                                                    <option value="Forecast">Forecast</option>
                                                }

                                                @if (se.Estado == "Pagada")
                                                {
                                                    <option value="Pagada" selected>Pagada</option>
                                                }
                                                else
                                                {
                                                    <option value="Pagada">Pagada</option>
                                                }
                                            </select>
                                        </td>

                                        <td class="p-2 border border-gray-300 text-left">
                                            <textarea rows="2" name="observacionserviciosocio" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48">@se.Observacion</textarea>
                                        </td>
                                        <td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentaservicio" readonly /></td>
                                        <td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentaservicio" readonly /></td>
                                        <td style="display:none;">
                                            <input type="hidden" name="EliminarServicioSocio" class="EliminarServicioSocio" value="false" />
                                        </td>
                                        <td class="p-2 border border-gray-300 text-left">
                                            <button type="button" class="bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-700" onclick="limpiarServicioSocio(this)">Eliminar</button>
                                        </td>
                                        <td style="display:none">
                                            <input type="text" class="idsegmentoservicio" name="idsegmentoserviciosocio" />
                                        </td>
                                    </tr>
                                    <input type="hidden" name="IdServicioRealsocio" value="@se.Id" />
                                    <input type="hidden" name="Tiposerviciosocio" value="@se.Tiposervicio" />
                                }

                            }
                        }
                        <tr>
                            <td class="p-2 border border-gray-300 text-left">
                                <select name="Idserviciosocio" class="serviciosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </select>
                            </td>
                            <td class="p-2 border border-gray-300 text-left">
                                <select name="Idproveedorsocio" class="proveedorSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </select>
                            </td>
                            <td class="p-2 border border-gray-300 text-right"><input type="text" id="montoservicio" name="montoserviciosocio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
                            <td class="p-2 border border-gray-300 text-left"><input type="date" name="fechaserviciosocio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
                            <td class="p-2 border border-gray-300 text-left">
                                <select name="Estadosocio" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">
                                    <option value="Forecast" selected>Forecast</option>
                                    <option value="Pagada">Pagada</option>
                                </select>
                            </td>

                            <td class="p-2 border border-gray-300 text-left">
                                <textarea rows="2" name="observacionserviciosocio" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
                            </td>
                            <td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentaservicio" readonly /></td>
                            <td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentaservicio" readonly /></td>
                            <td style="display:none;">
                                <input type="hidden" name="EliminarServicioSocio" class="EliminarServicioSocio" value="false" />
                            </td>
                            <td style="display:none">
                                <input type="text" class="idsegmentoservicio" name="idsegmentoserviciosocio" />
                            </td>
                            <input type="hidden" name="IdServicioRealsocio" value="" />
                            <input type="hidden" name="Tiposerviciosocio" value="Socios" />

                        </tr>

                    </tbody>
                </table>
                <button id="btnAgregarGastoSocio" class="px-4 py-2 text-sm text-white bg-blue-500 border border-gray-300 rounded transition duration-300 ease-in-out hover:bg-blue-400 hover:opacity-80">Agregar otro Servicio</button>

            </div>

        </div>*@



			@*staff*@
			<div class="form-group">

				<p class="form-subtitle" style="color:black;">Status Gastos HH Staff</p>
				<div class="overflow-x-auto">
					<table class="min-w-full text-xs border-collapse">
						<thead>
							<tr class="bg-blue-100 text-black">

								<th class="p-2 border border-gray-300 text-left">Fecha</th>
								<th class="p-2 border border-gray-300 text-left">FechaPago</th>
								<th class="p-2 border border-gray-300 text-left">IDCUENTA</th>
								<th class="p-2 border border-gray-300 text-left">Cuenta Contable</th>
								<th class="p-2 border border-gray-300 text-left">Horas Efectivas</th>
								<th class="p-2 border border-gray-300 text-left">SubTotal</th>
								<th class="p-2 border border-gray-300 text-left">Reajuste</th>
								<th class="p-2 border border-gray-300 text-left">Total</th>
								<th class="p-2 border border-gray-300 text-left">Glosa</th>


							</tr>
						</thead>
						<tbody>
							@if (ViewBag.GastosHH != null)
							{

								@for (int i = 0; i < ViewBag.GastosHH.Count; i++)
								{

									var gasto = ViewBag.GastosHH[i];
									@if (gasto.tiporecurso == "Staff" && gasto.estado != 2)
									{


										<tr>
											<input type="hidden" name="Tiporecursostaff" value="@gasto.tiporecurso" />
											<input type="hidden" name="Messtaff" value="@gasto.mes" />
											<input type="hidden" name="Aniostaff" value="@gasto.anio" />
											<input type="hidden" name="Subtotalstaff" value="@gasto.costorecurstaff" />
											<input type="hidden" name="HHtotalesstaff" value="@gasto.totalhh" />

											<td class="p-2 border border-gray-300 text-left">@gasto.mes/@gasto.anio</td>
											<input type="hidden" name="IdGastoHHstaff" value="@gasto.idgastohh" />
											@if (gasto.fechapago != null)
											{
												<td class="p-1 border border-gray-300 text-right">
													<input type="date" name="Fechapagostaff" value="@gasto.fechapago?.ToString("yyyy-MM-dd")" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" />
												</td>

											}

											else
											{
												<td class="p-1 border border-gray-300 text-right">
													<input type="date" name="Fechapagostaff" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" />
												</td>


											}

											<td class="p-2 border border-gray-300 text-right">@gasto.idcuentastaff</td>
											<td class="p-1">@gasto.cuentastaff</td>

											<td class="p-1 border border-gray-300 text-right w-20">@String.Format("{0:N2}", gasto.totalhh)</td>
											<td class="p-1 border border-gray-300 text-right w-25">@String.Format("{0:N0}", gasto.costorecurstaff)</td>
											@if (gasto.reajuste != null)
											{
												<td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}",gasto.reajuste ?? "")" name="Reajustestaff" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											}

											else
											{
												<td class="p-2 border border-gray-300 text-right"><input type="text" name="Reajustestaff" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											}
											@if (gasto.monto != null)
											{
												<td class="p-2 border border-gray-300 text-right"><input type="text" id="montostaff" value="@String.Format("{0:N0}",gasto.monto ?? "")" readonly name="Montostaff" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											}
											else
											{
												<td class="p-2 border border-gray-300 text-right"><input type="text" id="montostaff" readonly name="Montostaff" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											}
											@if (gasto.observacion != "")
											{

												<td class="p-2 border border-gray-300 text-left">
													<textarea rows="2" name="Observacionstaff" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48">@gasto.observacion</textarea>
												</td>

											}
											else
											{
												<td class="p-2 border border-gray-300 text-left">
													<textarea rows="2" name="Observacionstaff" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
												</td>
											}
											@if (gasto.estado == 1)
											{
												totalstaff += gasto.monto ?? 0;
											}




										</tr>
									}
								}

							}


						</tbody>
					</table>

				</div>

			</div>

			@*HH FORECAST Staff*@
			<div class="form-group">

				<p class="form-subtitle" style="color:black;">Forecast HH Staff</p>
				<div class="overflow-x-auto">
					<table id="tablahhStaff" class="min-w-full text-xs border-collapse">
						<thead>
							<tr class="bg-green-200 text-black">
								<th class="p-2 border border-gray-300 text-left">Fecha Pago</th>
								<th class="p-2 border border-gray-300 text-center">HH</th>
								<th class="p-2 border border-gray-300 text-left">Valor HH/Proyecto</th>
								<th class="p-2 border border-gray-300 text-left">Total</th>



								<th class="p-2 border border-gray-300 text-left">Glosa</th>

								<th class="p-2 border border-gray-300 text-left">IDCUENTA</th>
								<th class="p-2 border border-gray-300 text-left">Cuenta Contable</th>
								<th class="p-2 border border-gray-300 text-left">Acción</th>



							</tr>
						</thead>
						<tbody>
							@if (ViewBag.GastosHH != null)
							{
								@foreach (var gs in ViewBag.GastosHH)
								{
									if (gs.estado == 2 && gs.tiporecurso == "Staff")
									{
										<tr>
											<td class="p-2 border border-gray-300 text-left"><input type="date" value="@gs.fechapago.ToString("yyyy-MM-dd")" name="fechahhstaff" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
											<td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}", @gs.totalhh)" name="hhstaff" class="hhstaff form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											<td class="p-2 border border-gray-300 text-right costohhstaff">
												@String.Format("{0:N0}", @gs.costohhstaff)
											</td>
											<td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}",gs.monto ?? "")" readonly name="montohhstaff" class="montohhstaff form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>



											<td class="p-2 border border-gray-300 text-left">
												<textarea rows="2" name="observacionhhstaff" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48">@gs.observacion</textarea>
											</td>
											<td class="p-2 border border-gray-300 text-right ">@gs.idcuentastaff</td>
											<td class="p-2 border border-gray-300 text-left ">@gs.cuentastaff</td>

											<td style="display:none;">
												<input type="hidden" name="EliminarhhStaff" class="EliminarhhStaff" value="false" />
											</td>
											<td class="p-2 border border-gray-300 text-left">
												<button type="button" class="bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-700" onclick="limpiarhhStaff(this)">Eliminar</button>
											</td>

										</tr>
										totalstaffforecast += gs.monto;
										<input type="hidden" name="Idhhstaff" value="@gs.idgastohh" />
										<input type="hidden" name="estadohhstaff" value="@gs.estado" />
										<input type="hidden" name="recursohhstaff" value="@gs.tiporecurso" />
									}

								}
							}
							<tr>
								<td class="p-2 border border-gray-300 text-left"><input type="date" name="fechahhstaff" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
								<td class="p-2 border border-gray-300 text-right"><input type="text" name="hhstaff" class="hhstaff  form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
								<td class="p-2 border border-gray-300 text-right costohhstaff"> @String.Format("{0:N0}", costohhstaff)</td>
								<td class="p-2 border border-gray-300 text-right"><input type="text" id="montohhstaff" readonly name="montohhstaff" class="montohhstaff form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>



								<td class="p-2 border border-gray-300 text-left">
									<textarea rows="2" name="observacionhhstaff" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
								</td>
								<td class="p-2 border border-gray-300 text-right ">@idcuentastaff</td>
								<td class="p-2 border border-gray-300 text-left ">@cuentastaff</td>
								<td style="display:none;">
									<input type="hidden" name="EliminarhhStaff" class="EliminarhhStaff" value="false" />
								</td>

								<input type="hidden" name="Idhhstaff" value="" />
								<input type="hidden" name="estadohhstaff" value="2" />
								<input type="hidden" name="recursohhstaff" value="Staff" />
							</tr>

						</tbody>
					</table>
					<button id="btnAgregarhhStaff" class="px-4 py-2 text-sm text-white bg-blue-500 border border-gray-300 rounded transition duration-300 ease-in-out hover:bg-blue-400 hover:opacity-80">Agregar otro Forecast hh Staff</button>

				</div>

			</div>



			<div class="form-group">

				<p class="form-subtitle" style="color:black;">Status Honorarios Consultores Externos</p>
				<div class="overflow-x-auto">
					<table id="tablaHonorarios" class="min-w-full text-xs border-collapse">
						<thead>
							<tr class="bg-orange-100 text-black">
								<th class="p-2 border border-gray-300 text-left">TipoServicios</th>
								<th class="p-2 border border-gray-300 text-left">Proveedor</th>
								<th class="p-2 border border-gray-300 text-left">Monto</th>
								<th class="p-2 border border-gray-300 text-left">FechaPago</th>
								<th class="p-2 border border-gray-300 text-left">Estado</th>


								<th class="p-2 border border-gray-300 text-left">Glosa</th>

								<th class="p-2 border border-gray-300 text-left">IDCUENTA</th>
								<th class="p-2 border border-gray-300 text-left">Cuenta Contable</th>
								<th class="p-2 border border-gray-300 text-left">Acción</th>



							</tr>
						</thead>
						<tbody>
							@if (ViewBag.ServiciosEjecucion != null)
							{
								@foreach (var se in ViewBag.ServiciosEjecucion)
								{
									if (se.Tiposervicio == "Consultores Externos")
									{
										<tr>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Idserviciohonorario" class="serviciosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
													<option value="" disabled selected>Seleccione un Servicio</option>
													@if (ViewBag.Servicios != null)
													{
														@foreach (var servicio in ViewBag.Servicios)
														{
															if (servicio.Id == se.Idservicio)
															{
																<option value="@servicio.Id" selected>@servicio.Nombre</option>
															}
															else
															{
																<option value="@servicio.Id">@servicio.Nombre</option>
															}
														}
													}
												</select>

											</td>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Idproveedorhonorario" class="proveedorSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
													<option value="" disabled selected>Seleccione un Servicio</option>
													@if (ViewBag.Proveedores != null)
													{
														@foreach (var proveedor in ViewBag.Proveedores)
														{
															if (proveedor.Id == se.Idproveedor)
															{
																<option value="@proveedor.Id" selected>@proveedor.Nombre</option>
															}
															else
															{
																<option value="@proveedor.Id">@proveedor.Nombre</option>
															}
														}
													}
												</select>

											</td>
											<td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}", @se.Monto)" id="montoservicio" name="montoserviciohonorario" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											<td class="p-2 border border-gray-300 text-left"><input type="date" value="@se.Fecha.ToString("yyyy-MM-dd")" name="fechaserviciohonorario" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Estadohonorario" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">


													@if (se.Estado == "Forecast")
													{
														<option value="Forecast" selected>Forecast</option>
													}
													else
													{
														<option value="Forecast">Forecast</option>
													}

													@if (se.Estado == "Pagada")
													{
														<option value="Pagada" selected>Pagada</option>
													}
													else
													{
														<option value="Pagada">Pagada</option>
													}
												</select>
											</td>

											<td class="p-2 border border-gray-300 text-left">
												<textarea rows="2" name="observacionserviciohonorario" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48">@se.Observacion</textarea>
											</td>
											<td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentaservicio" readonly /></td>
											<td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentaservicio" readonly /></td>
											<td style="display:none;">
												<input type="hidden" name="EliminarServicioHonorario" class="EliminarServicioHonorario" value="false" />
											</td>
											<td class="p-2 border border-gray-300 text-left">
												<button type="button" class="bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-700" onclick="limpiarServicioHonorario(this)">Eliminar</button>
											</td>
											<td style="display:none">
												<input type="text" class="idsegmentoservicio" name="idsegmentoserviciohonorario" />
											</td>
										</tr>
										<input type="hidden" name="IdServicioRealhonorario" value="@se.Id" />
										<input type="hidden" name="Tiposerviciohonorario" value="@se.Tiposervicio" />
									}

								}
							}
							<tr>
								<td class="p-2 border border-gray-300 text-left">
									<select name="Idserviciohonorario" class="serviciosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
									</select>
								</td>
								<td class="p-2 border border-gray-300 text-left">
									<select name="Idproveedorhonorario" class="proveedorSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
									</select>
								</td>
								<td class="p-2 border border-gray-300 text-right"><input type="text" id="montoservicio" name="montoserviciohonorario" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
								<td class="p-2 border border-gray-300 text-left"><input type="date" name="fechaserviciohonorario" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
								<td class="p-2 border border-gray-300 text-left">
									<select name="Estadohonorario" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">
										<option value="Forecast" selected>Forecast</option>
										<option value="Pagada">Pagada</option>
									</select>
								</td>

								<td class="p-2 border border-gray-300 text-left">
									<textarea rows="2" name="observacionserviciohonorario" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
								</td>
								<td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentaservicio" readonly /></td>
								<td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentaservicio" readonly /></td>
								<td style="display:none;">
									<input type="hidden" name="EliminarServicioHonorario" class="EliminarServicioHonorario" value="false" />
								</td>
								<td style="display:none">
									<input type="text" class="idsegmentoservicio" name="idsegmentoserviciohonorario" />
								</td>
								<input type="hidden" name="IdServicioRealhonorario" value="" />
								<input type="hidden" name="Tiposerviciohonorario" value="Consultores Externos" />

							</tr>

						</tbody>
					</table>
					<button id="btnAgregarHonorario" class="px-4 py-2 text-sm text-white bg-blue-500 border border-gray-300 rounded transition duration-300 ease-in-out hover:bg-blue-400 hover:opacity-80">Agregar otro Servicio</button>

				</div>

			</div>
			@*SERVICIOS*@


			<div class="form-group">

				<p class="form-subtitle" style="color:black;">Status Servicios </p>
				<div class="overflow-x-auto">
					<table id="tablaServicios" class="min-w-full text-xs border-collapse">
						<thead>
							<tr class="bg-red-100 text-black">
								<th class="p-2 border border-gray-300 text-left">TipoServicios</th>
								<th class="p-2 border border-gray-300 text-left">Proveedor</th>
								<th class="p-2 border border-gray-300 text-left">Monto</th>
								<th class="p-2 border border-gray-300 text-left">FechaPago</th>
								<th class="p-2 border border-gray-300 text-left">Estado</th>


								<th class="p-2 border border-gray-300 text-left">Glosa</th>

								<th class="p-2 border border-gray-300 text-left">IDCUENTA</th>
								<th class="p-2 border border-gray-300 text-left">Cuenta Contable</th>
								<th class="p-2 border border-gray-300 text-left">Acción</th>



							</tr>
						</thead>
						<tbody>
							@if (ViewBag.ServiciosEjecucion != null)
							{
								@foreach (var se in ViewBag.ServiciosEjecucion)
								{
									if (se.Tiposervicio == "Otros")
									{
										<tr>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Idservicio" class="serviciosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
													<option value="" disabled selected>Seleccione un Servicio</option>
													@if (ViewBag.Servicios != null)
													{
														@foreach (var servicio in ViewBag.Servicios)
														{
															if (servicio.Id == se.Idservicio)
															{
																<option value="@servicio.Id" selected>@servicio.Nombre</option>
															}
															else
															{
																<option value="@servicio.Id">@servicio.Nombre</option>
															}
														}
													}
												</select>

											</td>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Idproveedor" class="proveedorSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
													<option value="" disabled selected>Seleccione un Servicio</option>
													@if (ViewBag.Proveedores != null)
													{
														@foreach (var proveedor in ViewBag.Proveedores)
														{
															if (proveedor.Id == se.Idproveedor)
															{
																<option value="@proveedor.Id" selected>@proveedor.Nombre</option>
															}
															else
															{
																<option value="@proveedor.Id">@proveedor.Nombre</option>
															}
														}
													}
												</select>

											</td>
											<td class="p-2 border border-gray-300 text-right"><input type="text" value="@String.Format("{0:N0}", @se.Monto)" id="montoservicio" name="montoservicio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											<td class="p-2 border border-gray-300 text-left"><input type="date" value="@se.Fecha.ToString("yyyy-MM-dd")" name="fechaservicio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Estado" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">


													@if (se.Estado == "Forecast")
													{
														<option value="Forecast" selected>Forecast</option>
													}
													else
													{
														<option value="Forecast">Forecast</option>
													}

													@if (se.Estado == "Pagada")
													{
														<option value="Pagada" selected>Pagada</option>
													}
													else
													{
														<option value="Pagada">Pagada</option>
													}
												</select>
											</td>

											<td class="p-2 border border-gray-300 text-left">
												<textarea rows="2" name="observacionservicio" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48">@se.Observacion</textarea>
											</td>
											<td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentaservicio" readonly /></td>
											<td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentaservicio" readonly /></td>
											<td style="display:none;">
												<input type="hidden" name="EliminarServicioOtro" class="EliminarServicioOtro" value="false" />
											</td>
											<td class="p-2 border border-gray-300 text-left">
												<button type="button" class="bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-700" onclick="limpiarServicioOtro(this)">Eliminar</button>
											</td>
											<td style="display:none;">
												<input type="text" class="idsegmentoservicio" name="idsegmentoserviciootro" />
											</td>
										</tr>
										<input type="hidden" name="IdServicioReal" value="@se.Id" />
										<input type="hidden" name="Tiposervicio" value="@se.Tiposervicio" />
									}

								}
							}
							<tr>
								<td class="p-2 border border-gray-300 text-left">
									<select name="Idservicio" class="serviciosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
									</select>
								</td>
								<td class="p-2 border border-gray-300 text-left">
									<select name="Idproveedor" class="proveedorSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
									</select>
								</td>
								<td class="p-2 border border-gray-300 text-right"><input type="text" id="montoservicio" name="montoservicio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
								<td class="p-2 border border-gray-300 text-left"><input type="date" name="fechaservicio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
								<td class="p-2 border border-gray-300 text-left">
									<select name="Estado" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">
										<option value="Forecast" selected>Forecast</option>
										<option value="Pagada">Pagada</option>
									</select>
								</td>

								<td class="p-2 border border-gray-300 text-left">
									<textarea rows="2" name="observacionservicio" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
								</td>
								<td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentaservicio" readonly /></td>
								<td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentaservicio" readonly /></td>
								<td style="display:none;">
									<input type="hidden" name="EliminarServicioOtro" class="EliminarServicioOtro" value="false" />
								</td>
								<td style="display:none;">
									<input type="text" class="idsegmentoservicio" name="idsegmentoserviciootro" />
								</td>
								<input type="hidden" name="IdServicioReal" value="" />
								<input type="hidden" name="Tiposervicio" value="Otros" />

							</tr>

						</tbody>
					</table>
					<button id="btnAgregarServicio" class="px-4 py-2 text-sm text-white bg-blue-500 border border-gray-300 rounded transition duration-300 ease-in-out hover:bg-blue-400 hover:opacity-80">Agregar otro Servicio</button>
				</div>

			</div>

			<div class="form-group">

				<p class="form-subtitle" style="color:black;">Status Gastos </p>
				<div class="overflow-x-auto">
					<table id="tablagastos" class="min-w-full text-xs border-collapse">
						<thead>
							<tr class="bg-yellow-100 text-black">
								<th class="p-2 border border-gray-300 text-left">TipoGasto</th>
								<th class="p-2 border border-gray-300 text-left">Proveedor</th>
								<th class="p-2 border border-gray-300 text-left">Monto</th>
								<th class="p-2 border border-gray-300 text-left">FechaPago</th>
								<th class="p-2 border border-gray-300 text-left">Estado</th>

								<th class="p-2 border border-gray-300 text-left">Glosa</th>
								<th class="p-2 border border-gray-300 text-left">IDCUENTA</th>
								<th class="p-2 border border-gray-300 text-left">Cuenta Contable</th>
								<th class="p-2 border border-gray-300 text-left">Acción</th>


							</tr>
						</thead>
						<tbody>
							@if (ViewBag.GastosEjecucion != null)
							{
								@foreach (var ge in ViewBag.GastosEjecucion)
								{
									<tr>
										<td class="p-2 border border-gray-300 text-left">
											<select name="idgastos" class="gastosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
												@if (ViewBag.Gastos != null)
												{
													@foreach (var gasto in ViewBag.Gastos)
													{
														if (gasto.Id == ge.Idgasto)
														{
															<option value="@gasto.Id" selected>@gasto.Nombre</option>
														}
														else
														{
															<option value="@gasto.Id">@gasto.Nombre</option>
														}
													}
												}

											</select>
										</td>
										<td class="p-2 border border-gray-300 text-left">
											<select name="idproveedorgastos" class="proveedorGastosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
												@if (ViewBag.ProGastos != null)
												{
													@foreach (var proveedor in ViewBag.ProGastos)
													{
														if (proveedor.Id == ge.Idproveedor)
														{
															<option value="@proveedor.Id" selected>@proveedor.Nombre</option>
														}
														else
														{
															<option value="@proveedor.Id">@proveedor.Nombre</option>
														}
													}
												}
											</select>
										</td>
										<td class="p-2 border border-gray-300 text-right"><input type="text" id="montogasto" name="montogasto" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" value="@String.Format("{0:N0}", @ge.Monto)" /></td>
										<td class="p-2 border border-gray-300 text-left"><input type="date" name="fechagasto" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" value="@ge.Fecha.ToString("yyyy-MM-dd")" /></td>
										<td class="p-2 border border-gray-300 text-left">
											<select name="EstadoGasto" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">


												@if (ge.Estado == "Forecast")
												{
													<option value="Forecast" selected>Forecast</option>
												}
												else
												{
													<option value="Forecast">Forecast</option>
												}

												@if (ge.Estado == "Pagada")
												{
													<option value="Pagada" selected>Pagada</option>
												}
												else
												{
													<option value="Pagada">Pagada</option>
												}
											</select>
										</td>

										<td class="p-2 border border-gray-300 text-left">
											<textarea rows="2" name="observaciongasto" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48">@ge.Observacion</textarea>
										</td>
										<td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentagastos" readonly /></td>
										<td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentagastos" readonly /></td>
										<td style="display:none;">
											<input type="hidden" name="esEliminados" class="esEliminados" value="false" />
										</td>
										<td class="p-2 border border-gray-300 text-left">
											<button type="button" class="bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-700" onclick="limpiarFilagasto(this)">Eliminar</button>
										</td>
										<td style="display:none">
											<input type="text" class="idsegmentogasto" name="idsegmentogasto" />
										</td>
									</tr>
									<input type="hidden" name="IdGastoReal" value="@ge.Id" />


								}




							}
							<tr>
								<td class="p-2 border border-gray-300 text-left">
									<select name="idgastos" class="gastosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
									</select>
								</td>
								<td class="p-2 border border-gray-300 text-left">
									<select name="idproveedorgastos" class="proveedorGastosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
									</select>
								</td>

								<td class="p-2 border border-gray-300 text-right"><input type="text" id="montogasto" name="montogasto" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
								<td class="p-2 border border-gray-300 text-left"><input type="date" name="fechagasto" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
								<td class="p-2 border border-gray-300 text-left">
									<select name="EstadoGasto" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">
										<option value="Forecast" selected>Forecast</option>
										<option value="Pagada">Pagada</option>
									</select>
								</td>

								<td class="p-2 border border-gray-300 text-left">
									<textarea rows="2" name="observaciongasto" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
								</td>
								<td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentagastos" readonly /></td>
								<td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentagastos" readonly /></td>
								<td style="display:none;">
									<input type="hidden" name="esEliminados" class="esEliminados" value="false" />
								</td>
								<td style="display:none">
									<input type="text" class="idsegmentogasto" name="idsegmentogasto" />
								</td>
								<td style="display:none;">
									<input type="hidden" name="IdGastoReal" value="" />
								</td>




							</tr>

						</tbody>
					</table>
					<td>
						<button id="agregarFilaGastos" class="px-4 py-2 text-sm text-white bg-blue-500 border border-gray-300 rounded transition duration-300 ease-in-out hover:bg-blue-400 hover:opacity-80">Agregar otro Gasto</button>
					</td>
				</div>

			</div>
			<div class="form-group">

				<p class="form-subtitle" style="color:black;">Resumen Costos del proyecto </p>
				<div class="flex justify-center py-5">
					<div class="overflow-x-auto w-full">
						<table id="tablaresumen" class="min-w-full text-xs border-collapse border border-gray-300">
							<thead>
								<tr class="bg-red-400 text-black">
									<th class="p-2 border border-gray-300 text-left min-w-[150px]">Tipo</th>
									<th class="p-2 border border-gray-300 text-left min-w-[100px]">IdCuenta</th>
									<th class="p-2 border border-gray-300 text-left min-w-[150px]">Cuenta Contable</th>
									<th class="p-2 border border-gray-300 text-center min-w-[150px]">Total Proyectado</th>
									<th class="p-2 border border-gray-300 text-center min-w-[150px]">Total Real</th>
									<th class="p-2 border border-gray-300 text-center min-w-[150px]">Total Forecast</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="p-2 border border-gray-300 text-left">HH Socios</td>
									@if (idcuentasocio > 0)
									{
										<td class="p-2 border border-gray-300 text-left">@idcuentasocio</td>
									}
									else
									{
										<td class="p-2 border border-gray-300 text-left"></td>
									}

									<td class="p-2 border border-gray-300 text-left">@cuentasocio</td>
									<td class="p-2 border border-gray-300 text-right">
										@(totalsociosproyectados != 0 ? String.Format("{0:N0}", totalsociosproyectados) : "")
									</td>
									<td class="p-2 border border-gray-300 text-right" id="totalSocios">
										@(totalsocios != 0 ? String.Format("{0:N0}", totalsocios) : "")
									</td>
									<td class="p-2 border border-gray-300 text-right">
										@(totalsociosforecast != 0 ? String.Format("{0:N0}", totalsociosforecast) : "")
									</td>

								</tr>
								<tr>
									<td class="p-2 border border-gray-300 text-left">HH Staff</td>
									@if (idcuentastaff > 0)
									{
										<td class="p-2 border border-gray-300 text-left">@idcuentastaff</td>
									}
									else
									{
										<td class="p-2 border border-gray-300 text-left"></td>
									}

									<td class="p-2 border border-gray-300 text-left">@cuentastaff</td>
									<td class="p-2 border border-gray-300 text-right">
										@(totalstaffproyectados != 0 ? String.Format("{0:N0}", totalstaffproyectados) : "")
									</td>
									<td class="p-2 border border-gray-300 text-right" id="totalStaff">
										@(totalstaff != 0 ? String.Format("{0:N0}", totalstaff) : "")
									</td>
									<td class="p-2 border border-gray-300 text-right">
										@(totalstaffforecast != 0 ? String.Format("{0:N0}", totalstaffforecast) : "")
									</td>

								</tr>

								@{
									decimal totalforecastservicio = 0;
									decimal totalforecastgasto = 0;
								}
								@foreach (var servicio in ViewBag.ServiciosProyectos)
								{
									decimal totaleservicioPagado = 0;
									decimal totaleservicioForecast = 0;
									if (ViewBag.ServiciosTotalesPagados.ContainsKey(servicio.IDSERVICIO))
									{
										totaleservicioPagado = ViewBag.ServiciosTotalesPagados[servicio.IDSERVICIO];
									}
									if (ViewBag.ServiciosTotalesForecast.ContainsKey(servicio.IDSERVICIO))
									{
										totaleservicioForecast = ViewBag.ServiciosTotalesForecast[servicio.IDSERVICIO];
									}
									<tr data-id="@servicio.IDSERVICIO">
										<td class="p-2 border border-gray-300 text-left">@servicio.NOMBRESERVICIO</td>
										<td class="p-2 border border-gray-300 text-left">@servicio.IDCUENTA</td>
										<td class="p-2 border border-gray-300 text-left">@servicio.CUENTA</td>
										<td class="p-2 border border-gray-300 text-right">
											@(servicio.MONTO != 0 ? String.Format("{0:N0}", servicio.MONTO) : "")
										</td>
										<td class="p-2 border border-gray-300 text-right total-row">
											@(totaleservicioPagado != 0 ? String.Format("{0:N0}", totaleservicioPagado) : "")
										</td>
										<td class="p-2 border border-gray-300 text-right">
											@(totaleservicioForecast != 0 ? String.Format("{0:N0}", totaleservicioForecast) : "")
										</td>

									</tr>
									totalserviciosproyectados += servicio.MONTO;
									totalforecastservicio += totaleservicioForecast;
								}
								@foreach (var gasto in ViewBag.GastosProyectos)
								{
									decimal totalesgastopagados = 0;
									decimal totalesgastoforecast = 0;
									if (ViewBag.GastosTotalesPagados.ContainsKey(gasto.IDGASTOS))
									{
										totalesgastopagados = ViewBag.GastosTotalesPagados[gasto.IDGASTOS];
									}
									if (ViewBag.GastosTotalesForecast.ContainsKey(gasto.IDGASTOS))
									{
										totalesgastoforecast = ViewBag.GastosTotalesForecast[gasto.IDGASTOS];
									}
									<tr>
										<td class="p-2 border border-gray-300 text-left">@gasto.NOMBREGASTO</td>
										<td class="p-2 border border-gray-300 text-left">@gasto.IDCUENTA</td>
										<td class="p-2 border border-gray-300 text-left">@gasto.CUENTA</td>
										<td class="p-2 border border-gray-300 text-right">
											@(gasto.MONTO != 0 ? String.Format("{0:N0}", gasto.MONTO) : "")
										</td>
										<td class="p-2 border border-gray-300 text-right" id="totalGastos_@gasto.IDGASTOS">
											@(totalesgastopagados != 0 ? String.Format("{0:N0}", totalesgastopagados) : "")
										</td>
										<td class="p-2 border border-gray-300 text-right">
											@(totalesgastoforecast != 0 ? String.Format("{0:N0}", totalesgastoforecast) : "")
										</td>

									</tr>
									totalgastosproyectados += gasto.MONTO;
									totalforecastgasto += totalesgastoforecast;
								}

								<tr>
									@{
										totalcostosproyectados = totalsociosproyectados + totalstaffproyectados + totalserviciosproyectados + totalgastosproyectados;
										decimal totalcostosforecast = totalforecastgasto + totalforecastservicio + totalsociosforecast + totalstaffforecast;
									}
									<td colspan="3" class="p-2 border border-gray-300 text-left font-bold">Totales</td>

									<td class="p-2 border border-gray-300 text-right font-bold">@String.Format("{0:N0}", totalcostosproyectados)</td>
									<td class="p-2 border border-gray-300 text-right font-bold" id="totalCostos">0</td>
									<td class="p-2 border border-gray-300 text-right font-bold">@String.Format("{0:N0}", totalcostosforecast)</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>


			</div>
			<div class="text-center mt-2">
				<button type="submit" class="px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-semibold rounded-md transition">Guardar Costos</button>
			</div>



		</form>
		<div class="form-group">

			<p class="form-subtitle" style="color:black;">Resumen Forecast Proveedores del proyecto </p>
			<div class="flex justify-center py-5">
				<div class="overflow-x-auto w-full">
					<table id="tablaforecastproveedor" class="min-w-full text-xs border-collapse border border-gray-300">
						<thead>
							<tr class="bg-green-100 text-black">
								<th class="p-2 border border-gray-300 text-left min-w-[150px]">Proveedor</th>
								<th class="p-2 border border-gray-300 text-left min-w-[100px]">Cuenta</th>
								<th class="p-2 border border-gray-300 text-left min-w-[150px]">Nombre</th>
								<th class="p-2 border border-gray-300 text-center min-w-[150px]">fecha</th>

							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
			</div>


		</div>
	</div>
</div>

<script>


	/*SERVICIOS */

	$(document).ready(function () {

		$('.serviciosSelect').each(function () {
			var $select = $(this);
			var $row = $select.closest('tr');


			var selectedOption = $select.find('option:selected').val();
			if (selectedOption) {

				const idUnidadNegocio = $("#unidadNegocio").val();
				const idCentroCosto = $("#centroCosto").val();
				var nombreservicio = $(this).find('option:selected').val();


				$.ajax({
					url: '/Proyecto/GetValoresServiciosEdicion',
					type: 'GET',
					data: {
						idcosto: idCentroCosto,
						unegocio: idUnidadNegocio,
						idservicio: nombreservicio
					},
					success: function (data) {
						const $button = $('.bg-green-500');
						if (data && data.length > 0) {

							$row.find('.idcuentaservicio').val(data[0].idcuenta);
							$row.find('.cuentaservicio').val(data[0].cuenta);
							$row.find('.idsegmentoservicio').val(data[0].idsegmento);
							$button.prop('disabled', false);
						} else {
							alert("No existe una cuenta o segmento enlazado a este servicio.");
							$row.find('.idcuentaservicio').val('');
							$row.find('.cuentaservicio').val('');
							$row.find('.idsegmentoservicio').val('');
							$button.prop('disabled', true);
						}
					},
					error: function (xhr, status, error) {
						console.error("Error en la solicitud AJAX:", error);
					}
				});
			}
		});
	});


	$(document).on('change', '.serviciosSelect', function () {
		var $row = $(this).closest('tr');
		const idUnidadNegocio = $("#unidadNegocio").val();
		const idCentroCosto = $("#centroCosto").val();
		var nombreservicio = $(this).find('option:selected').val();
		console.log(idUnidadNegocio);
		console.log(idCentroCosto);
		console.log(nombreservicio);
		$.ajax({
			url: '/Proyecto/GetValoresServiciosEdicion',
			type: 'GET',
			data: {
				idcosto: idCentroCosto,
				unegocio: idUnidadNegocio,
				idservicio: nombreservicio
			},
			success: function (data) {
				const $button = $('.bg-green-500');
				if (data && data.length > 0) {


					$row.find('.idcuentaservicio').val(data[0].idcuenta);
					$row.find('.cuentaservicio').val(data[0].cuenta);
					$row.find('.idsegmentoservicio').val(data[0].idsegmento);
					$button.prop('disabled', false);

				} else {
					alert("No existe una cuenta o segmento enlazado a este servicio.");
					$row.find('.idcuentaservicio').val('');
					$row.find('.cuentaservicio').val('');
					$row.find('.idsegmentoservicio').val('');
					$button.prop('disabled', true);
				}
			},
			error: function (xhr, status, error) {
				console.error("Error en la solicitud AJAX:", error);
			}
		});
	});





	function cargarServicios(selectElement) {
		var valorSeleccionado = $(selectElement).val();
		$.ajax({
			url: '/Proyecto/ObtenerServicios',
			type: 'GET',
			success: function (data) {
				$(selectElement).empty();
				$(selectElement).append('<option value="" disabled selected>Seleccione un Servicio</option>');

				$.each(data, function (index, servicio) {
					$(selectElement).append('<option value="' + servicio.id + '">' + servicio.nombre + '</option>');
				});
				if (valorSeleccionado) {
					$(selectElement).val(valorSeleccionado);
				}
			},
			error: function () {
				alert('Ocurrió un error al cargar los servicios.');
			}
		});
	}


	$(document).ready(function () {
		$('.serviciosSelect').each(function () {
			cargarServicios(this);
		});
		$('.proveedorSelect').each(function () {
			cargarProveedoresServicios(this);
		});
	});

	function cargarProveedoresServicios(selectElement) {
		var valorSeleccionado = $(selectElement).val();
		$.ajax({
			url: '/EjecucionProyecto/ObtenerProveedoresServicios',
			type: 'GET',
			success: function (data) {
				$(selectElement).empty();
				$(selectElement).append('<option value="" disabled selected>Seleccione un Proveedor</option>');

				$.each(data, function (index, proveedor) {
					$(selectElement).append('<option value="' + proveedor.id + '">' + proveedor.nombre + '</option>');
				});
				if (valorSeleccionado) {
					$(selectElement).val(valorSeleccionado);
				}
			},
			error: function () {
				alert('Ocurrió un error al cargar los proveedor.');
			}
		});
	}

	/*FORMATEAR MONTOS SERVICIOS Y GASTOS*/
	document.addEventListener('DOMContentLoaded', function () {

		function formatCurrency(event) {
			let value = event.target.value;


			value = value.replace(/[^\d-]/g, '');


			if (value.includes('-') && value.indexOf('-') > 0) {
				value = '-' + value.replace(/-/g, '');
			}

			if (value !== '' && value !== '-') {
				const isNegative = value.startsWith('-');
				value = value.replace(/-/g, '');


				let formattedValue = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');


				if (isNegative) {
					formattedValue = '-' + formattedValue;
				}

				event.target.value = formattedValue;
			} else {
				event.target.value = value;
			}



			updateTotal();
		}



		function removePoints(event) {
			let value = event.target.value;


			value = value.replace(/\./g, '');
			event.target.value = value;
		}

		function updateMontoGeneral(reajusteInput) {
			const row = reajusteInput.closest('tr');
			const name = reajusteInput.name;

			const isStaff = name.includes('Reajustestaff');

			const reajusteValue = parseCurrency(reajusteInput.value);
			const subtotalInputName = isStaff ? 'Subtotalstaff' : 'Subtotal';
			const montoInputName = isStaff ? 'Montostaff' : 'Monto';

			const subtotalValue = parseCurrency(row.querySelector(`input[name*="${subtotalInputName}"]`).value);
			const montoInput = row.querySelector(`input[name*="${montoInputName}"]`);

			const total = reajusteValue + subtotalValue;
			montoInput.value = total.toLocaleString('es-CL');
		}


		const allReajusteInputs = document.querySelectorAll('input[name*="Reajuste"]');

		allReajusteInputs.forEach(input => {
			input.addEventListener('input', (e) => {
				formatCurrency(e);
				updateMontoGeneral(input);
			});
		});



		function parseCurrency(value) {
			return parseInt(value.replace(/\./g, ''), 10) || 0;
		}


		function updateTotal() {
			let totalservicio = 0;
			let totalgasto = 0;
			let totalsocio = 0;
			let totalstaff = 0;

			let totalCostos = 0;
			const montogastoRows = document.querySelectorAll('tr');

			const montoInputs = document.querySelectorAll('input[name*="montoservicio"]');
			const montogastosocioInputs = document.querySelectorAll('input[name*="montoserviciosocio"]');
			const montohonorarioInputs = document.querySelectorAll('input[name*="montoserviciohonorario"]');
			const montoSocioInputs = document.querySelectorAll('input[id*="montosocio"]');
			const montoStaffInputs = document.querySelectorAll('input[id*="montostaff"]');



			montoInputs.forEach(input => {
				const estadoSelect = input.closest('tr').querySelector('select[name="Estado"]');
				if (estadoSelect && estadoSelect.value === "Pagada") {
					totalservicio += parseCurrency(input.value);
				}
			});
			montogastosocioInputs.forEach(input => {
				const estadoSelect = input.closest('tr').querySelector('select[name="Estadosocio"]');
				if (estadoSelect && estadoSelect.value === "Pagada") {
					totalservicio += parseCurrency(input.value);
				}
			});
			montohonorarioInputs.forEach(input => {
				const estadoSelect = input.closest('tr').querySelector('select[name="Estadohonorario"]');
				if (estadoSelect && estadoSelect.value === "Pagada") {
					totalservicio += parseCurrency(input.value);
				}
			});
			montogastoRows.forEach(row => {
				const montoInput = row.querySelector('input[name="montogasto"]');
				const estadoSelect = row.querySelector('select[name="EstadoGasto"]');

				if (estadoSelect && estadoSelect.value === "Pagada") {
					totalgasto += parseCurrency(montoInput.value);
				}
			});




			const totalSocios = parseCurrency(document.getElementById('totalSocios').textContent);
			const totalStaff = parseCurrency(document.getElementById('totalStaff').textContent);



			totalCostos = totalSocios + totalStaff + totalservicio + totalgasto;


			document.getElementById('totalCostos').textContent = totalCostos.toLocaleString('es-CL');
		}


		function cleanInputsOnSubmit(event) {

			const inputs = event.target.querySelectorAll('input[name*="montoservicio"], input[name*="montogasto"], input[name*="Reajuste"], input[name*="Monto"],input[name*="Montostaff"]');

			inputs.forEach(input => {

				let value = input.value;
				value = value.replace(/\./g, '');
				input.value = value;
			});
		}







		const montoInputs = document.querySelectorAll('input[name*="montoservicio"], input[name*="montogasto"],input[name*="Reajuste"],input[name*="montoserviciosocio"],input[name*="montoserviciohonorario"]');


		montoInputs.forEach(input => {
			input.addEventListener('input', formatCurrency);
		});


		const form = document.querySelector('form');
		if (form) {
			form.addEventListener('submit', cleanInputsOnSubmit);
		}
		document.getElementById("btnAgregarServicio").addEventListener("click", function () {

			setTimeout(() => {

				const nuevosMontos = document.querySelectorAll('input[name*="montoservicio"]');

				nuevosMontos.forEach(input => {
					if (!input.hasAttribute('data-format-listener')) {
						input.addEventListener('input', formatCurrency);
						input.setAttribute('data-format-listener', 'true');
					}
				});
			}, 100);
		});

		document.getElementById("btnAgregarHonorario").addEventListener("click", function () {

			setTimeout(() => {

				const nuevosMontos = document.querySelectorAll('input[name*="montoserviciohonorario"]');

				nuevosMontos.forEach(input => {
					if (!input.hasAttribute('data-format-listener')) {
						input.addEventListener('input', formatCurrency);
						input.setAttribute('data-format-listener', 'true');
					}
				});
			}, 100);
		});
		document.getElementById("agregarFilaGastos").addEventListener("click", function () {

			setTimeout(() => {

				const nuevosMontos = document.querySelectorAll('input[name*="montogasto"]');

				nuevosMontos.forEach(input => {
					if (!input.hasAttribute('data-format-listener')) {
						input.addEventListener('input', formatCurrency);
						input.setAttribute('data-format-listener', 'true');
					}
				});
			}, 100);
		});

		updateTotal();
	});

	/*NUEVAS FILAS TABLA SERVICIO*/
	var servicios = [];
	var proveedores = [];

	function cargarDatosIniciales() {
		$.ajax({
			url: '/Proyecto/ObtenerServicios',
			type: 'GET',
			success: function (data) {
				servicios = data;
			},
			error: function () {
				alert('Ocurrió un error al cargar los servicios.');
			}
		});

		$.ajax({
			url: '/EjecucionProyecto/ObtenerProveedoresServicios',
			type: 'GET',
			success: function (data) {
				proveedores = data;
			},
			error: function () {
				alert('Ocurrió un error al cargar los proveedores.');
			}
		});
	}

	function rellenarSelectServicios(selectElement) {
		$(selectElement).empty();
		$(selectElement).append('<option value="" disabled selected>Seleccione un Servicio</option>');
		$.each(servicios, function (index, servicio) {
			$(selectElement).append('<option value="' + servicio.id + '">' + servicio.nombre + '</option>');
		});
	}

	function rellenarSelectProveedores(selectElement) {
		$(selectElement).empty();
		$(selectElement).append('<option value="" disabled selected>Seleccione un Proveedor</option>');
		$.each(proveedores, function (index, proveedor) {
			$(selectElement).append('<option value="' + proveedor.id + '">' + proveedor.nombre + '</option>');
		});
	}

	$(document).ready(function () {
		cargarDatosIniciales();

		$('.serviciosSelect').each(function () {
			rellenarSelectServicios(this);
		});
		$('.proveedorSelect').each(function () {
			rellenarSelectProveedores(this);
		});

		$('#btnAgregarServicio').on('click', function (e) {
			e.preventDefault();

			var nuevaFila = `
								<tr>
											<td class="p-2 border border-gray-300 text-left">
												<select  name="Idservicio" class="serviciosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">

												</select>
											</td>
											<td class="p-2 border border-gray-300 text-left">
												<select  name="Idproveedor" class="proveedorSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">

												</select>
											</td>
												<td class="p-2 border border-gray-300 text-right"><input  type="text" id="montoservicio" name="montoservicio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
												<td class="p-2 border border-gray-300 text-left"><input  type="date" name="fechaservicio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
													 <td class="p-2 border border-gray-300 text-left">
													<select name="Estado" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">
														<option value="Forecast" selected>Forecast</option>
														<option value="Pagada">Pagada</option>
													</select>
												</td>

													<td class="p-2 border border-gray-300 text-left">
													<textarea rows="2" name="observacionservicio" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
												</td>
											<td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentaservicio" readonly/></td>
											<td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentaservicio" readonly/></td>
												 <td style="display:none;">
														<input type="hidden" name="EliminarServicioOtro" class="EliminarServicioOtro" value="false" />
													</td>
											   <td style="display:none">
										<input type="text" class="idsegmentoservicio" name="idsegmentoserviciootro" />
									</td>
												<input type="hidden" name="IdServicioReal" value="" />
													<input type="hidden" name="Tiposervicio" value="Otros" />

										</tr>
						`;

			$('#tablaServicios tbody').append(nuevaFila);

			var lastRow = $('#tablaServicios tbody tr:last');
			rellenarSelectServicios(lastRow.find('.serviciosSelect'));
			rellenarSelectProveedores(lastRow.find('.proveedorSelect'));
		});
	});



	/*agregar hh socio*/
	$(document).ready(function () {
		function parseNumber(str) {
			return parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
		}


		function formatNumber(num) {
			return num.toLocaleString('es-CL', { minimumFractionDigits: 0 });
		}


		function calcularMontosHHsocio() {
			$('#tablahhSocios tbody tr').each(function () {
				const row = $(this);

				const hhInput = row.find('.hhsocio');
				const montoInput = row.find('.montohhsocio');
				const costoTd = row.find('.costohhsocio');

				const hhRaw = hhInput.val().trim();
				const costoTexto = costoTd.text().trim();


				if (hhRaw !== "") {
					const hhValue = parseNumber(hhRaw);
					const costoValue = parseNumber(costoTexto);

					const total = hhValue * costoValue;
					montoInput.val(formatNumber(total));
				}

			});
		}



		$(document).on('input', '.hhsocio', function () {
			calcularMontosHHsocio();
		});


		$('#btnAgregarhhSocio').on('click', function (e) {
			e.preventDefault();

			var nuevaFila = `
										   <tr>
												   <td class="p-2 border border-gray-300 text-left"><input type="date" name="fechahhsocio" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
									<td class="p-2 border border-gray-300 text-right"><input type="text"   name="hhsocio" class="hhsocio  form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
										<td class="p-2 border border-gray-300 text-right costohhsocio"> @String.Format("{0:N0}", @costohhscio)</td>
									<td class="p-2 border border-gray-300 text-right"><input type="text" id="montohhsocio"  readonly name="montohhsocio" class="montohhsocio  form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>



								<td class="p-2 border border-gray-300 text-left">
									<textarea rows="2" name="observacionhhsocio" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
								</td>
								<td class="p-2 border border-gray-300 text-right ">@idcuentasocio</td>
								<td class="p-2 border border-gray-300 text-left ">@cuentasocio</td>
								<td style="display:none;">
									<input type="hidden" name="EliminarhhSocio" class="EliminarhhSocio" value="false" />
								</td>

								<input type="hidden" name="Idhhsocio" value="" />
									 <input type="hidden" name="estadohhsocio" value="2" />
									 <input type="hidden" name="recursohhsocio" value="Socio" />
											</tr>
								`;

			$('#tablahhSocios tbody').append(nuevaFila);

			var lastRow = $('#tablahhSocios tbody tr:last');

		});
	});

	 /*agregar hh staff*/
	$(document).ready(function () {
		 function parseNumber(str) {
			return parseFloat(str.replace(/\./g, '').replace(',', '.')) || 0;
		}


		function formatNumber(num) {
			return num.toLocaleString('es-CL', { minimumFractionDigits: 0 });
		}


		function calcularMontosHHstaff() {
			$('#tablahhStaff tbody tr').each(function () {
				const row = $(this);

				const hhInput = row.find('.hhstaff');
				const montoInput = row.find('.montohhstaff');
				const costoTd = row.find('.costohhstaff');

				const hhRaw = hhInput.val().trim();
				const costoTexto = costoTd.text().trim();


				if (hhRaw !== "") {
					const hhValue = parseNumber(hhRaw);
					const costoValue = parseNumber(costoTexto);

					const total = hhValue * costoValue;
					montoInput.val(formatNumber(total));
				}

			});
		}



		$(document).on('input', '.hhstaff', function () {
			calcularMontosHHstaff();
		});


		$('#btnAgregarhhStaff').on('click', function (e) {
			e.preventDefault();

			var nuevaFila = `
										   <tr>
												 <td class="p-2 border border-gray-300 text-left"><input type="date" name="fechahhstaff" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
							<td class="p-2 border border-gray-300 text-right"><input type="text" name="hhstaff" class="hhstaff  form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
							<td class="p-2 border border-gray-300 text-right costohhstaff"> @String.Format("{0:N0}", costohhstaff)</td>
							<td class="p-2 border border-gray-300 text-right"><input type="text" id="montohhstaff" readonly name="montohhstaff" class="montohhstaff form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>



							<td class="p-2 border border-gray-300 text-left">
								<textarea rows="2" name="observacionhhstaff" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
							</td>
							<td class="p-2 border border-gray-300 text-right ">@idcuentastaff</td>
							<td class="p-2 border border-gray-300 text-left ">@cuentastaff</td>
							<td style="display:none;">
								<input type="hidden" name="EliminarhhStaff" class="EliminarhhStaff" value="false" />
							</td>

							<input type="hidden" name="Idhhstaff" value="" />
							<input type="hidden" name="estadohhstaff" value="2" />
							<input type="hidden" name="recursohhstaff" value="Staff" />
											</tr>
								`;

			$('#tablahhStaff tbody').append(nuevaFila);

			var lastRow = $('#tablahhStaff tbody tr:last');

		});
	});
	/*honorarios externos */
	$(document).ready(function () {
		cargarDatosIniciales();

		$('.serviciosSelect').each(function () {
			rellenarSelectServicios(this);
		});
		$('.proveedorSelect').each(function () {
			rellenarSelectProveedores(this);
		});

		$('#btnAgregarHonorario').on('click', function (e) {
			e.preventDefault();

			var nuevaFila = `
										   <tr>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Idserviciohonorario" class="serviciosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
												</select>
											</td>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Idproveedorhonorario" class="proveedorSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
												</select>
											</td>
											<td class="p-2 border border-gray-300 text-right"><input type="text" id="montoservicio" name="montoserviciohonorario" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" /></td>
											<td class="p-2 border border-gray-300 text-left"><input type="date" name="fechaserviciohonorario" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" /></td>
											<td class="p-2 border border-gray-300 text-left">
												<select name="Estadohonorario" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">
													<option value="Forecast" selected>Forecast</option>
													<option value="Pagada">Pagada</option>
												</select>
											</td>

											<td class="p-2 border border-gray-300 text-left">
												<textarea rows="2" name="observacionserviciohonorario" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
											</td>
											<td class="p-2 border border-gray-300 text-right "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentaservicio" readonly /></td>
											<td class="p-2 border border-gray-300 text-left "><input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentaservicio" readonly /></td>
												<td style="display:none;">
											<input type="hidden" name="EliminarServicioHonorario" class="EliminarServicioHonorario" value="false" />
										</td>
											  <td style="display:none">
										<input type="text" class="idsegmentoservicio" name="idsegmentoserviciohonorario" />
									</td>
											<input type="hidden" name="IdServicioRealhonorario" value="" />
											<input type="hidden" name="Tiposerviciohonorario" value="Consultores Externos" />

										</tr>
								`;

			$('#tablaHonorarios tbody').append(nuevaFila);

			var lastRow = $('#tablaHonorarios tbody tr:last');
			rellenarSelectServicios(lastRow.find('.serviciosSelect'));
			rellenarSelectProveedores(lastRow.find('.proveedorSelect'));
		});
	});
	/*GASTOS*/
	$(document).ready(function () {

		$('.gastosSelect').each(function () {
			var $select = $(this);
			var $row = $select.closest('tr');


			var selectedOption = $select.find('option:selected').val();
			if (selectedOption) {

				const idUnidadNegocio = $("#unidadNegocio").val();
				const idCentroCosto = $("#centroCosto").val();
				var nombreGasto = $select.find('option:selected').val();

				$.ajax({
					url: '/Proyecto/GetValoresGastosEdicion',
					type: 'GET',
					data: {
						idcosto: idCentroCosto,
						unegocio: idUnidadNegocio,
						idgasto: nombreGasto
					},
					success: function (data) {
						const $button = $('.bg-green-500');
						if (data && data.length > 0) {
							$row.find('.segmentogastos').val(data[0].nombre);
							$row.find('.idcuentagastos').val(data[0].idcuenta);
							$row.find('.cuentagastos').val(data[0].cuenta);
							$row.find('.idsegmentogasto').val(data[0].idsegmento);
							$button.prop('disabled', false);
						} else {
							alert("No existe una cuenta o segmento enlazado a este gasto.");
							$row.find('.segmentogastos').val('');
							$row.find('.idcuentagastos').val('');
							$row.find('.cuentagastos').val('');
							$row.find('.idsegmentogasto').val('');
							$button.prop('disabled', true);
						}
					},
					error: function (xhr, status, error) {
						console.error("Error en la solicitud AJAX:", error);
					}
				});
			}
		});
	});

	$(document).on('change', '.gastosSelect', function () {
		var $row = $(this).closest('tr');
		const idUnidadNegocio = $("#unidadNegocio").val();
		const idCentroCosto = $("#centroCosto").val();
		var nombreGasto = $(this).find('option:selected').val();

		$.ajax({
			url: '/Proyecto/GetValoresGastosEdicion',
			type: 'GET',
			data: {
				idcosto: idCentroCosto,
				unegocio: idUnidadNegocio,
				idgasto: nombreGasto
			},
			success: function (data) {
				const $button = $('.bg-green-500');
				if (data && data.length > 0) {

					$row.find('.segmentogastos').val(data[0].nombre);
					$row.find('.idcuentagastos').val(data[0].idcuenta);
					$row.find('.cuentagastos').val(data[0].cuenta);
					$row.find('.idsegmentogasto').val(data[0].idsegmento);
					$button.prop('disabled', false);
				} else {
					alert("No existe una cuenta o segmento enlazado a este gasto.");
					$row.find('.segmentogastos').val('');
					$row.find('.idcuentagastos').val('');
					$row.find('.cuentagastos').val('');
					$row.find('.idsegmentogasto').val('');
					$button.prop('disabled', true);
				}
			},
			error: function (xhr, status, error) {
				console.error("Error en la solicitud AJAX:", error);
			}
		});
	});

	function cargarGastos(selectElement) {
		var valorSeleccionado = $(selectElement).val();
		$.ajax({
			url: '/Proyecto/ObtenerGastos',
			type: 'GET',
			success: function (data) {
				$(selectElement).empty();
				$(selectElement).append('<option value="" disabled selected>Seleccione un gasto</option>');


				$.each(data, function (index, gasto) {
					$(selectElement).append('<option value="' + gasto.id + '">' + gasto.nombre + '</option>');
				});
				if (valorSeleccionado) {
					$(selectElement).val(valorSeleccionado);
				}
			},
			error: function () {
				alert('Ocurrió un error al cargar los gastos.');
			}
		});
	}

	function cargarProveedoresGastos(selectElement) {
		var valorSeleccionado = $(selectElement).val();
		$.ajax({
			url: '/EjecucionProyecto/ObtenerProveedoresGastos',
			type: 'GET',
			success: function (data) {
				$(selectElement).empty();
				$(selectElement).append('<option value="" disabled selected>Seleccione un Proveedor</option>');

				$.each(data, function (index, proveedor) {
					$(selectElement).append('<option value="' + proveedor.id + '">' + proveedor.nombre + '</option>');
				});
				if (valorSeleccionado) {
					$(selectElement).val(valorSeleccionado);
				}
			},
			error: function () {
				alert('Ocurrió un error al cargar los proveedor.');
			}
		});
	}


	$(document).ready(function () {

		$('.gastosSelect').each(function () {
			cargarGastos(this);
		});
		$('.proveedorGastosSelect').each(function () {
			cargarProveedoresGastos(this);
		});


		$('#agregarFilaGastos').on('click', function (e) {
			e.preventDefault();


			var nuevaFila = `
							<tr>
								<td class="p-2 border border-gray-300 text-left">
									<select name="idgastos" class="gastosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
										<option value="" disabled selected>Seleccione un gasto</option>
									</select>
								</td>
								<td class="p-2 border border-gray-300 text-left">
									 <select name="idproveedorgastos" class="proveedorGastosSelect px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
										<option value="" disabled selected>Seleccione un proveedor</option>
									</select>
								</td>
								<td class="p-2 border border-gray-300 text-right">
									<input type="text" id="montogasto" name="montogasto" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-25" />
								</td>
								<td class="p-2 border border-gray-300 text-left">
									<input type="date" name="fechagasto" class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-30" />
								</td>
									 <td class="p-2 border border-gray-300 text-left">
												<select name="EstadoGasto" class="px-4 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ">
													<option value="Forecast" selected>Forecast</option>
													<option value="Pagada">Pagada</option>
												</select>
											</td>


									 <td class="p-2 border border-gray-300 text-left">
												<textarea rows="2" name="observaciongasto" class="form-control text-left px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48"></textarea>
											</td>
								<td class="p-2 border border-gray-300 text-right">
									<input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 idcuentagastos" readonly />
								</td>
								<td class="p-2 border border-gray-300 text-left">
									<input class="form-control text-right px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-48 cuentagastos" readonly />
								</td>
									<td style="display:none;">
													<input type="hidden" name="esEliminados" class="esEliminados" value="false" />
												</td>
								<td style="display:none">
									<input type="text" class="idsegmentogasto" name="idsegmentogasto" />
								</td>
								<td style="display:none;">
									<input type="hidden" name="IdGastoReal" value="" />
								</td>
							</tr>
						`;


			$('#tablagastos tbody').append(nuevaFila);


			$('#tablagastos tbody tr:last .gastosSelect').each(function () {
				cargarGastos(this);
			});
			$('#tablagastos tbody tr:last .proveedorGastosSelect').each(function () {
				cargarProveedoresGastos(this);
			});
		});
	});
	/*Eliminar Servicio Otro*/
	function limpiarServicioOtro(button) {
		var fila = button.closest('tr');


		var esEliminado = fila.querySelector('input.EliminarServicioOtro');
		if (esEliminado) {
			esEliminado.value = 'true';
		}

		fila.style.display = 'none';
	}
	/*Eliminar Servicio Honorario*/
	function limpiarServicioHonorario(button) {

		var fila = button.closest('tr');


		var esEliminado = fila.querySelector('input.EliminarServicioHonorario');
		if (esEliminado) {
			esEliminado.value = 'true';
		}

		fila.style.display = 'none';


	}


	/*Eliminar hh Socio*/
	function limpiarhhSocio(button) {

		var fila = button.closest('tr');


		var esEliminado = fila.querySelector('input.EliminarhhSocio');
		if (esEliminado) {
			esEliminado.value = 'true';
		}

		fila.style.display = 'none';


	}

	 /*Eliminar hh Staff*/
	function limpiarhhStaff(button) {

		var fila = button.closest('tr');


		var esEliminado = fila.querySelector('input.EliminarhhStaff');
		if (esEliminado) {
			esEliminado.value = 'true';
		}

		fila.style.display = 'none';


	}

	/*Eliminar Gasto*/
	function limpiarFilagasto(button) {
		var fila = button.closest('tr');


		var esEliminado = fila.querySelector('input.esEliminados');
		if (esEliminado) {
			esEliminado.value = 'true';
		}

		fila.style.display = 'none';

	}


	/*forecast proveedores*/
	$(document).ready(function () {

		var idproyecto = '@Context.Session.GetInt32("numproyecto")';


		$.ajax({
			url: '/EjecucionProyecto/RecuperarForecastProveedores',
			type: 'GET',
			data: { idproyecto: idproyecto },
			success: function (data) {
				renderizarTabla(data);
			},
			error: function (err) {
				console.error('Error al recuperar los datos:', err);
			}
		});

		function renderizarTabla(data) {
			const tabla = $('#tablaforecastproveedor');
			const tablaBody = tabla.find('tbody');
			const tablaHead = tabla.find('thead');


			tablaBody.empty();
			tablaHead.empty();


			const mesesUnicos = [...new Set(data.map(item => `${item.mes.toString().padStart(2, '0')}-${item.anio}`))]
				.sort((a, b) => {
					const [mesA, anioA] = a.split('-').map(Number);
					const [mesB, anioB] = b.split('-').map(Number);
					const fechaA = new Date(anioA, mesA - 1);
					const fechaB = new Date(anioB, mesB - 1);
					return fechaA - fechaB;
				});


			let encabezado = `
								<tr class="bg-green-100 text-black">
								<th class="p-2 border border-gray-300 text-left min-w-[150px]">Proveedor</th>
								<th class="p-2 border border-gray-300 text-left min-w-[100px]">Cuenta</th>
								<th class="p-2 border border-gray-300 text-left min-w-[150px]">Nombre</th>`;
			mesesUnicos.forEach(mes => {
				encabezado += `<th class="p-2 border border-gray-300 text-center">${mes}</th>`;
			});
			encabezado += `<th class="p-2 border border-gray-300 text-right">Total Proveedores</th>`;
			encabezado += `</tr>`;
			tablaHead.append(encabezado);


			const totalesPorMes = new Array(mesesUnicos.length).fill(0);
			let totalGeneral = 0;


			const agrupados = agruparPor(data, ['nombreproveedor', 'cuenta', 'nombre']);

			for (let [key, registros] of Object.entries(agrupados)) {
				const [proveedor, cuenta, nombre] = key.split('|');


				let fila = `
								<tr>
									<td class="p-2 border border-gray-300 text-left">${proveedor}</td>
									<td class="p-2 border border-gray-300 text-left">${cuenta}</td>
									<td class="p-2 border border-gray-300 text-left">${nombre}</td>`;


				let totalFila = 0;
				mesesUnicos.forEach((mes, index) => {
					const registroMes = registros.find(r => `${r.mes.toString().padStart(2, '0')}-${r.anio}` === mes);
					const monto = registroMes ? registroMes.totalforecastproveedor : null;

					if (monto === null || monto === 0) {
						fila += `<td class="p-2 border border-gray-300 text-right"></td>`;
					} else {
						totalFila += monto;
						totalesPorMes[index] += monto;
						fila += `<td class="p-2 border border-gray-300 text-right">${formatMoneda(monto)}</td>`;
					}
				});


				fila += `<td class="p-2 border border-gray-300 text-right font-bold">${formatMoneda(totalFila)}</td>`;
				fila += `</tr>`;
				tablaBody.append(fila);
				totalGeneral += totalFila;
			}


			let filaTotales = `
								<tr class="bg-green-100">
								<td class="p-2 border border-gray-300 text-left font-bold" colspan="3">Totales</td>`;
			totalesPorMes.forEach(totalMes => {
				filaTotales += `<td class="p-2 border border-gray-300 text-right font-bold">${formatMoneda(totalMes)}</td>`;
			});
			filaTotales += `<td class="p-2 border border-gray-300 text-right font-bold">${formatMoneda(totalGeneral)}</td>`;
			filaTotales += `</tr>`;


			tablaBody.append(filaTotales);
		}


		function agruparPor(array, keys) {
			return array.reduce((result, item) => {
				const groupKey = keys.map(key => item[key]).join('|');
				if (!result[groupKey]) {
					result[groupKey] = [];
				}
				result[groupKey].push(item);
				return result;
			}, {});
		}


		function formatMoneda(valor) {
			return valor.toLocaleString('de-DE', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
		}
	});

</script>