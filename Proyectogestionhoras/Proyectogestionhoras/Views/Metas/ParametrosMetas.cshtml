@{
    ViewData["Title"] = "Parametros Metas";

}
<h1 class="text-2xl font-bold mb-4 text-gray-800">Meta Facturación Qx</h1>

<div class="container mx-auto mt-4 p-6 bg-white rounded-lg shadow-lg">
    <!-- Contenedor con Flexbox para colocar la tabla a la izquierda y el formulario a la derecha -->
    <div class="flex space-x-8">

        <!-- Contenedor de la Tabla -->
        <div class="w-2/3 bg-white p-6 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-4">Tabla de Facturación</h2>
            <table class="min-w-full divide-y divide-gray-200" id="tablaReporte">
                <thead class="bg-blue-200">
                    <tr>
                        <th class="text-left text-sm font-semibold text-gray-700 px-4 py-2">Año</th>
                        <th class="text-left text-sm font-semibold text-gray-700 px-4 py-2">Q1</th>
                        <th class="text-left text-sm font-semibold text-gray-700 px-4 py-2">Q2</th>
                        <th class="text-left text-sm font-semibold text-gray-700 px-4 py-2">Q3</th>
                        <th class="text-left text-sm font-semibold text-gray-700 px-4 py-2">Q4</th>
                        <th class="text-left text-sm font-semibold text-gray-700 px-4 py-2">Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var factura in ViewBag.DatosFacturas)
                    {
                        <tr>
                            <td class="text-left text-sm font-semibold text-gray-700 px-4 py-2">@factura.Anio</td>
                            <td class="text-right text-sm font-semibold text-gray-700 px-4 py-2">@String.Format("{0:N2}", @factura.q1)</td>
                            <td class="text-right text-sm font-semibold text-gray-700 px-4 py-2">@String.Format("{0:N2}", @factura.q2)</td>
                            <td class="text-right text-sm font-semibold text-gray-700 px-4 py-2">@String.Format("{0:N2}", @factura.q3)</td>
                            <td class="text-right text-sm font-semibold text-gray-700 px-4 py-2">@String.Format("{0:N2}", @factura.q4)</td>
                            <td class="text-right text-sm font-semibold text-gray-700 px-4 py-2">@String.Format("{0:N2}", @factura.totalq)</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Contenedor del Formulario -->
        <div class="w-1/3 bg-gray-50 p-6 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-4">Registrar Nueva Meta</h2>
            <form action="@Url.Action("RegistrarMetaFacturas", "Metas")" method="post" enctype="multipart/form-data">
                <div class="mb-4">
                    <label for="anio" class="block text-sm font-semibold text-gray-700">Año</label>
                    <input type="number" name="anio" id="anio" required class="w-full p-2 border border-gray-300 rounded focus:ring focus:ring-blue-200 focus:outline-none text-right" />
                </div>

                <div class="mb-4">
                    <label for="q1" class="block text-sm font-semibold text-gray-700">Q1</label>
                    <input type="text" name="q1" id="q1" required class="format-number w-full p-2 border border-gray-300 rounded focus:ring focus:ring-blue-200 focus:outline-none text-right" />
                </div>

                <div class="mb-4">
                    <label for="q2" class="block text-sm font-semibold text-gray-700">Q2</label>
                    <input type="text" name="q2" id="q2" required class="format-number w-full p-2 border border-gray-300 rounded focus:ring focus:ring-blue-200 focus:outline-none text-right" />
                </div>

                <div class="mb-4">
                    <label for="q3" class="block text-sm font-semibold text-gray-700">Q3</label>
                    <input type="text" name="q3" id="q3" required class="format-number w-full p-2 border border-gray-300 rounded focus:ring focus:ring-blue-200 focus:outline-none text-right" />
                </div>

                <div class="mb-4">
                    <label for="q4" class="block text-sm font-semibold text-gray-700">Q4</label>
                    <input type="text" name="q4" id="q4" required class="format-number w-full p-2 border border-gray-300 rounded focus:ring focus:ring-blue-200 focus:outline-none text-right" />
                </div>

                <div class="mb-4">
                    <label for="total" class="block text-sm font-semibold text-gray-700">Total</label>
                    <input type="text" name="total" id="total" class="w-full p-2 border border-gray-300 rounded focus:ring focus:ring-blue-200 focus:outline-none text-right" readonly />
                </div>

                <div>
                    <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded shadow focus:ring focus:ring-blue-300 focus:outline-none">Guardar</button>
                </div>
            </form>
        </div>

    </div>
</div>

<script>
    // Función para formatear el número con puntos por miles
    function formatNumberWithDots(number) {
        return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    // Función para actualizar el total
    function updateTotal() {
        // Obtener los valores de Q1, Q2, Q3, Q4 y quitar los puntos
        let q1 = parseFloat(document.querySelector('input[name="q1"]').value.replace(/\./g, '')) || 0;
        let q2 = parseFloat(document.querySelector('input[name="q2"]').value.replace(/\./g, '')) || 0;
        let q3 = parseFloat(document.querySelector('input[name="q3"]').value.replace(/\./g, '')) || 0;
        let q4 = parseFloat(document.querySelector('input[name="q4"]').value.replace(/\./g, '')) || 0;

        // Sumar los valores
        let total = q1 + q2 + q3 + q4;

        // Formatear el total con puntos por miles y actualizar el campo de total
        document.querySelector('input[name="total"]').value = formatNumberWithDots(total);
    }

    // Evento para formatear el valor del input y actualizar el total
    document.querySelectorAll('.format-number').forEach(function (input) {
        input.addEventListener('input', function () {
            // Remover los puntos para evitar problemas al sumar
            let value = this.value.replace(/\./g, '');

            if (!isNaN(value) && value !== '') {
                this.value = formatNumberWithDots(value);
            }

            // Actualizar el total cada vez que se cambia un valor
            updateTotal();
        });
    });
</script>